<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NOE Tourismus</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" th:href="@{/css/style.css}" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <!-- JAVA EINBINDUNG ACHILL -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Codeanfang_Achill_24.03.2024/27.08.2024/28.08.2024/01.04.2024/03.04.2024/16.05.2024/17.05.2024/18.05.2024_Page-Navigation,SwitchZIPAscDesc,HotelDataInfo -->
    <script>
        $(document).ready(function() {
            // Debugging: Überprüfen, ob eine Fehlermeldung vorhanden ist
            var errorMessage = $('.modal-body p').text().trim();
            console.log("Fehlermeldung: ", errorMessage);

            // Überprüfen, ob eine Fehlermeldung vorhanden ist und das Modal anzeigen
            if (errorMessage.length > 0) {
                $('#errorModal').modal('show');
                console.log("Modal wird angezeigt");
            } else {
                console.log("Keine Fehlermeldung vorhanden");
            }
        });

        //Code Anfang #3_Nikola_02.05 Occupancy Form
        function addOccupancy(element) {
            // Daten auslesen
            const hotelId = element.getAttribute('data-id');
            const hotelName = element.getAttribute('data-name');
            const hotelZip = element.getAttribute('data-zip');
            const maxRooms = element.getAttribute('data-maxRooms');
            const maxBeds = element.getAttribute('data-maxBeds');

            const formUrl = `/occupancyform?hotelId=${hotelId}&hotelName=${encodeURIComponent(hotelName)}&hotelZip=${hotelZip}&maxRooms=${maxRooms}&maxBeds=${maxBeds}`;

            window.location.href = formUrl;
        }
        function deleteHotel(element) {
            // Daten auslesen
            const hotelId = element.getAttribute('data-id');
            const hotelName = element.getAttribute('data-name');
            const hotelZip = element.getAttribute('data-zip');

            const formUrl = `/deletehotel?hotelId=${hotelId}&hotelName=${encodeURIComponent(hotelName)}&hotelZip=${hotelZip}`;

            window.location.href = formUrl;
        }
        //Code Ende #3_Nikola_02.05 Occupancy Form

        // Codeanfang_Achill
        function sortTable(n) {
            var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
            table = document.getElementById("hotelData");
            switching = true;
            // Set the sorting direction to ascending:
            dir = "asc";
            /* Make a loop that will continue until no switching has been done: */
            while (switching) {
                // Starting by no switching is done:
                switching = false;
                rows = table.rows;
                /* Loop through all table rows (except the first, which contains table headers): */
                for (i = 1; i < (rows.length - 1); i++) {
                    // Starting by saying there should be no switching:
                    shouldSwitch = false;
                    /* Getting the two elements to compare, one from current row and one from the next: */
                    x = rows[i].getElementsByTagName("TD")[n];
                    y = rows[i + 1].getElementsByTagName("TD")[n];
                    /* Check if the two rows should switch place, based on the direction, asc or desc: */
                    if (dir == "asc") {
                        if (Number(x.innerHTML) > Number(y.innerHTML)) {
                            // If so, mark as a switch and break the loop:
                            shouldSwitch = true;
                            break;
                        }
                    } else if (dir == "desc") {
                        if (Number(x.innerHTML) < Number(y.innerHTML)) {
                            // If so, mark as a switch and break the loop:
                            shouldSwitch = true;
                            break;
                        }
                    }
                }
                if (shouldSwitch) {
                    /* If a switch has been marked, make the switch and mark that a switch has been done: */
                    rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                    switching = true;
                    // Each time a switch is done, increase this count by 1:
                    switchcount++;
                } else {
                    /* If no switching has been done AND the direction is "asc", set the direction to "desc" and run the while loop again. */
                    if (switchcount == 0 && dir == "asc") {
                        dir = "desc";
                        switching = true;
                    }
                }
            }
        }
        // CodeAnfang_Achill_ImportCsv Data

        document.addEventListener('DOMContentLoaded', (event) => {
            const triggerCsvImportButton = document.getElementById('triggerCsvImport');
            if (triggerCsvImportButton) {
                triggerCsvImportButton.addEventListener('click', function () {
                    fetch('/trigger-csv-import')
                        .then(response => {
                            if (response.ok) {
                                response.text().then(text => alert('Erfolg: ' + text));
                            } else {
                                response.text().then(text => alert('Fehler: ' + text));
                            }
                        })
                        .catch(error => {
                            console.error('Fehler beim Anfordern der URL: ', error);
                            alert('Netzwerkfehler: ' + error.message);
                        });
                });
            }
        });
        // CodeAnfang_Achill_Pageination

        $(document).ready(function () {
            $('#pageSizeTop, #pageSizeBottom').change(function () {
                // Das Formular automatisch absenden, wenn eine neue Option ausgewählt wird
                this.form.submit();
            });

            // Setze den ausgewählten Wert basierend auf dem Wert im localStorage oder dem vom Server zurückgegebenen Wert
            var storedSize = localStorage.getItem('selectedSize') || '10';
            $('#pageSizeTop, #pageSizeBottom').val(storedSize);

            // Speichere den ausgewählten Wert im localStorage, wenn das Formular abgesendet wird
            $('#pageSizeTop, #pageSizeBottom').on('change', function () {
                localStorage.setItem('selectedSize', $(this).val());
            });

            /* PDF-Modal Achill
            $("#myBtn").click(function (event) {
                event.preventDefault();
                fetch('/report/pdf')
                    .then(response => {
                        if (response.ok) {
                            $("#myModal").show();
                        } else {
                            alert("Error generating the report");
                        }
                    })
                    .catch(error => {
                        alert("An error occurred: " + error);
                    });
            }); */

            $("#myModal .close, #myModal #closeBtn").click(function () {
                $("#myModal").hide();
            });

            $(window).click(function (event) {
                if ($(event.target).is("#myModal")) {
                    $("#myModal").hide();
                }
            });

            // Hotel-Info-Modal ACHILL
            function showHotelInfo(button) {
                var hotelId = $(button).data('id');
                var hotelName = $(button).data('name');
                var hotelAddress = $(button).data('address');
                var hotelZIP = $(button).data('zip');
                var hotelCity = $(button).data('city');
                var hotelOwner = $(button).data('owner');
                var hotelContact = $(button).data('contact');
                var hotelPhone = $(button).data('phone');
                var hotelemail = $(button).data('email-address');
                var hotelurl = $(button).data('url');
                var hotelcategory = $(button).data('category');
                var hotelfamilyFriendly = $(button).data('family-friendly');
                var hoteldogFriendly = $(button).data('dog-friendly')
                var hotelspa = $(button).data('spa');
                var hotelfitness = $(button).data('fitness');
                var hotelsubscribed = $(button).data('subscribed');

                var modalContent = $('#hotelInfoContent');
                modalContent.html(
                    '<strong>Hotel ID:</strong> ' + hotelId + '<br>' +
                    '<strong>Hotel Name:</strong> ' + hotelName + '<br>' +
                    '<strong>Address:</strong> ' + hotelAddress + '<br>' +
                    '<strong>ZIP:</strong> ' + hotelZIP + '<br>' +
                    '<strong>City:</strong> ' + hotelCity + '<br>' +
                    '<strong>Owner:</strong> ' + hotelOwner + '<br>' +
                    '<strong>Contact:</strong> ' + hotelContact + '<br>' +
                    '<strong>Phone:</strong> ' + hotelPhone + '<br>' +
                    '<strong>E-Mail Address:</strong> ' + hotelemail + '<br>' +
                    '<strong>URL:</strong> <a href="' + hotelurl + '" target="_blank">' + hotelurl + '</a><br><br> ' +
                    '<strong>Category:</strong> ' + hotelcategory + '<br>' +
                    '<strong>family friendly:</strong> ' + (hotelfamilyFriendly ? '<img src="/images/okgreenPNG.png" alt="okgreen" style="width: 20px; height: 20px;">' : '<img src="/images/noredPNG.png" alt="nored" style="width: 20px; height: 20px;">') + '<br>' +
                    '<strong>dog friendly:</strong> ' + (hoteldogFriendly ? '<img src="/images/okgreenPNG.png" alt="okgreen" style="width: 20px; height: 20px;">' : '<img src="/images/noredPNG.png" alt="nored" style="width: 20px; height: 20px;">') + '<br>' +
                    '<strong>spa:</strong> ' + (hotelspa ? '<img src="/images/okgreenPNG.png" alt="okgreen" style="width: 20px; height: 20px;">' : '<img src="/images/noredPNG.png" alt="nored" style="width: 20px; height: 20px;">') + '<br>' +
                    '<strong>fitness:</strong> ' + (hotelfitness ? '<img src="/images/okgreenPNG.png" alt="okgreen" style="width: 20px; height: 20px;">' : '<img src="/images/noredPNG.png" alt="nored" style="width: 20px; height: 20px;">') + '<br>' +
                    '<strong>subscribed:</strong> ' + (hotelsubscribed ? '<img src="/images/okgreenPNG.png" alt="okgreen" style="width: 20px; height: 20px;">' : '<img src="/images/noredPNG.png" alt="nored" style="width: 20px; height: 20px;">') + '<br>'
                );

                $('#hotelInfoModal').show();
            }

            // Event-Listener für Info-Buttons registrieren
            $('.infoBtn').on('click', function () {
                showHotelInfo(this);
            });

            $("#hotelInfoModal .close, #hotelInfoModal #closeInfo").click(function () {
                $("#hotelInfoModal").hide();
            });

            $(window).click(function (event) {
                if ($(event.target).is("#hotelInfoModal")) {
                    $("#hotelInfoModal").hide();
                }
            });

            //Codebegin_Lang_27.04.2024_Histogramm_Popup Window

            $(document).ready(function() {
                // Histogram-Modal anzeigen
                $('#btnHistogram').on('click', function() {
                    $("#histogramModal").show();
                    drawHistogram();
                });

                // Schließen des Histogramm-Modals
                $("#histogramModal .close, #histogramModal #histogramCloseBtn").click(function() {
                    $("#histogramModal").hide();
                });

                // Wenn außerhalb des Modals geklickt wird, dieses schließen
                $(window).click(function(event) {
                    if ($(event.target).is("#histogramModal")) {
                        $("#histogramModal").hide();
                    }
                });

                //Codebegin_Req#8_Lang_04.05.2024_Help Button Pop Up Window

                $(document).ready(function() {
                    // Show Help-Modal on btnHelp click
                    $('#btnHelp').on('click', function() {
                        $("#helpModal").show();
                    });

                    // Close Help-Modal
                    $("#helpModal .close, #helpModal #helpCloseBtn").click(function() {
                        $("#helpModal").hide();
                    });

                    // Close Help-Modal when clicking outside of it
                    $(window).click(function(event) {
                        if ($(event.target).is("#helpModal")) {
                            $("#helpModal").hide();
                        }
                    });
                });

                //Codeend_Req#8_Lang_04.05.2024_Help Button Pop Up Window

                //Codebegin_Lang_04.05.2024_19.05.2024_AddHotel Button Pop Up Window

                $(document).ready(function() {
                    console.log('Document ready');

                    $('#btnAddHotel').on('click', function() {
                        console.log('Add Hotel button clicked');
                        $('#addHotelModal').show();
                    });

                    $('#addHotelCloseBtn').on('click', function() {
                        console.log('Close button clicked');
                        $('#addHotelModal').hide();
                        $('#addHotelForm')[0].reset(); // Setzt alle Felder im Formular zurück
                        resetValidation(); // Setzt die Validierungsfehler zurück
                    });

                    $(window).on('click', function(event) {
                        if ($(event.target).is('#addHotelModal')) {
                            console.log('Clicked outside modal');
                            $('#addHotelModal').hide();
                            $('#addHotelForm')[0].reset(); // Setzt alle Felder im Formular zurück
                            resetValidation(); // Setzt die Validierungsfehler zurück
                        }
                    });

                    $('#addHotelForm').on('submit', function(event) {
                        event.preventDefault();
                        console.log('Form submitted');

                        // Validierung
                        let isValid = true;

                        const hotelDetails = {

                            name: $('#addHotelName').val(),
                            address: $('#addHotelAddress').val(),
                            cityCode: $('#addHotelZip').val(),
                            city: $('#addHotelCity').val(),
                            owner: $('#addHotelOwner').val(),
                            contact: $('#addHotelContact').val(),
                            phone: $('#addHotelPhone').val(),
                            emailAddress: $('#addHotelEmail').val(),
                            url: $('#addHotelUrl').val(),
                            noRooms: $('#addHotelRooms').val(),
                            noBeds: $('#addHotelBeds').val(),
                            category: $('#addHotelCategory').val(),
                            familyFriendly: $('#addHotelFamilyFriendly').is(':checked'),
                            dogFriendly: $('#addHotelDogFriendly').is(':checked'),
                            spa: $('#addHotelSpa').is(':checked'),
                            fitness: $('#addHotelFitness').is(':checked'),
                            subscribed: $('#addHotelSubscribed').is(':checked')

                        };

                        // Hotel Name Validierung
                        if (!hotelDetails.name) {
                            isValid = false;
                            $('#addHotelName').addClass('is-invalid');
                            $('#addHotelName').attr('title', 'Hotel name is required.');
                        } else {
                            $('#addHotelName').removeClass('is-invalid');
                            $('#addHotelName').removeAttr('title');
                        }

                        // Address Validierung
                        if (!hotelDetails.address) {
                            isValid = false;
                            $('#addHotelAddress').addClass('is-invalid');
                            $('#addHotelAddress').attr('title', 'Address is required.');
                        } else {
                            $('#addHotelAddress').removeClass('is-invalid');
                            $('#addHotelAddress').removeAttr('title');
                        }

                        // ZIP Validierung
                        if (!hotelDetails.cityCode) {
                            isValid = false;
                            $('#addHotelZip').addClass('is-invalid');
                            $('#addHotelZip').attr('title', 'ZIP code is required.');
                        } else if (parseInt(hotelDetails.cityCode) < 1010 || parseInt(hotelDetails.cityCode) > 9992) {
                            isValid = false;
                            $('#addHotelZip').addClass('is-invalid');
                            $('#addHotelZip').attr('title', 'ZIP code must be between 1010 and 9992.');
                        } else {
                            $('#addHotelZip').removeClass('is-invalid');
                            $('#addHotelZip').removeAttr('title');
                        }

                        // City Validierung
                        if (!hotelDetails.city) {
                            isValid = false;
                            $('#addHotelCity').addClass('is-invalid');
                            $('#addHotelCity').attr('title', 'City is required.');
                        } else if (!/^[a-zA-Z\s]+$/.test(hotelDetails.city)) {
                            isValid = false;
                            $('#addHotelCity').addClass('is-invalid');
                            $('#addHotelCity').attr('title', 'City must contain only letters.');
                        } else {
                            $('#addHotelCity').removeClass('is-invalid');
                            $('#addHotelCity').removeAttr('title');
                        }

                        // Owner Validierung
                        if (!hotelDetails.owner) {
                            isValid = false;
                            $('#addHotelOwner').addClass('is-invalid');
                            $('#addHotelOwner').attr('title', 'Owner is required.');
                        } else if (!/^[a-zA-Z\s]+$/.test(hotelDetails.owner)) {
                            isValid = false;
                            $('#addHotelOwner').addClass('is-invalid');
                            $('#addHotelOwner').attr('title', 'Owner must contain only letters.');
                        } else {
                            $('#addHotelOwner').removeClass('is-invalid');
                            $('#addHotelOwner').removeAttr('title');
                        }

                        // Contact Validierung
                        if (!hotelDetails.contact) {
                            isValid = false;
                            $('#addHotelContact').addClass('is-invalid');
                            $('#addHotelContact').attr('title', 'Contact is required.');
                        } else if (!/^[a-zA-Z\s]+$/.test(hotelDetails.contact)) {
                            isValid = false;
                            $('#addHotelContact').addClass('is-invalid');
                            $('#addHotelContact').attr('title', 'Contact must contain only letters.');
                        } else {
                            $('#addHotelContact').removeClass('is-invalid');
                            $('#addHotelContact').removeAttr('title');
                        }

                        // Phone Validierung
                        if (!hotelDetails.phone) {
                            isValid = false;
                            $('#addHotelPhone').addClass('is-invalid');
                            $('#addHotelPhone').attr('title', 'Phone number is required.');
                        } else if (!/^[\d\s\+\-()]+$/.test(hotelDetails.phone)) {
                            isValid = false;
                            $('#addHotelPhone').addClass('is-invalid');
                            $('#addHotelPhone').attr('title', 'Phone number must contain only numbers and special characters.');
                        } else {
                            $('#addHotelPhone').removeClass('is-invalid');
                            $('#addHotelPhone').removeAttr('title');
                        }

                        // E-Mail Validierung
                        if (!hotelDetails.emailAddress) {
                            isValid = false;
                            $('#addHotelEmail').addClass('is-invalid');
                            $('#addHotelEmail').attr('title', 'E-mail is required.');
                        } else if (!/@/.test(hotelDetails.emailAddress)) {
                            isValid = false;
                            $('#addHotelEmail').addClass('is-invalid');
                            $('#addHotelEmail').attr('title', 'E-mail must contain "@".');
                        } else {
                            $('#addHotelEmail').removeClass('is-invalid');
                            $('#addHotelEmail').removeAttr('title');
                        }

                        // URL Validierung
                        if (!hotelDetails.url) {
                            isValid = false;
                            $('#addHotelUrl').addClass('is-invalid');
                            $('#addHotelUrl').attr('title', 'URL is required.');
                        } else {
                            $('#addHotelUrl').removeClass('is-invalid');
                            $('#addHotelUrl').removeAttr('title');
                        }

                        // Rooms Validierung
                        if (!hotelDetails.noRooms) {
                            isValid = false;
                            $('#addHotelRooms').addClass('is-invalid');
                            $('#addHotelRooms').attr('title', 'Number of rooms is required.');
                        } else if (!/^\d+$/.test(hotelDetails.noRooms)) {
                            isValid = false;
                            $('#addHotelRooms').addClass('is-invalid');
                            $('#addHotelRooms').attr('title', 'Rooms must contain only numbers.');
                        } else {
                            $('#addHotelRooms').removeClass('is-invalid');
                            $('#addHotelRooms').removeAttr('title');
                        }

                        // Beds Validierung
                        if (!hotelDetails.noBeds) {
                            isValid = false;
                            $('#addHotelBeds').addClass('is-invalid');
                            $('#addHotelBeds').attr('title', 'Number of beds is required.');
                        } else if (!/^\d+$/.test(hotelDetails.noBeds)) {
                            isValid = false;
                            $('#addHotelBeds').addClass('is-invalid');
                            $('#addHotelBeds').attr('title', 'Beds must contain only numbers.');
                        } else {
                            $('#addHotelBeds').removeClass('is-invalid');
                            $('#addHotelBeds').removeAttr('title');
                        }

                        // Category Validierung
                        if (!hotelDetails.category || !['1', '2', '3', '4', '5'].includes(hotelDetails.category)) {
                            isValid = false;
                            $('#addHotelCategory').addClass('is-invalid');
                            $('#addHotelCategory').attr('title', 'Category is required.');
                        } else {
                            $('#addHotelCategory').removeClass('is-invalid');
                            $('#addHotelCategory').removeAttr('title');
                        }

                        // Kategorie-Mapping
                        const categoryMapping = {
                            '1': 4,
                            '2': 3,
                            '3': 2,
                            '4': 1,
                            '5': 0
                        };
                        hotelDetails.category = categoryMapping[hotelDetails.category];

                        if (isValid) {
                            fetch('/addhotel', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(hotelDetails)
                            })
                                .then(response => response.json())
                                .then(data => {
                                    if (data.success) {
                                        let hotelId = data.hotelId;
                                        if (confirm('Hotel successfully added to the database!')) {
                                            showHotelInfo({id: hotelId});
                                        }
                                        $('#addHotelModal').hide();
                                        $('#addHotelForm')[0].reset();
                                    } else {
                                        alert('Failed to add hotel to the database.');
                                    }
                                })
                                .catch(error => {
                                    console.error('Error:', error);
                                    alert('Error adding hotel to the database.');
                                });
                        }
                    });

                    function showHotelInfo(hotel) {
                        // Daten des Hotels werden abgerufen und im Modal angezeigt
                        fetch(`/hotelinfo/${hotel.id}`)
                            .then(response => response.json())
                            .then(data => {
                                console.log(data); // Debugging

                                // Befüllt das Modal mit den Daten des Hotels
                                $('#hotelInfoContent').html(`
                                    <strong>Hotel ID:</strong> ${data.id}<br>
                                    <strong>Hotel Name:</strong> ${data.name}<br>
                                    <strong>Address:</strong> ${data.address}<br>
                                    <strong>ZIP:</strong> ${data.cityCode}<br>
                                    <strong>City:</strong> ${data.city}<br>
                                    <strong>Owner:</strong> ${data.owner}<br>
                                    <strong>Contact:</strong> ${data.contact}<br>
                                    <strong>Phone:</strong> ${data.phone}<br>
                                    <strong>E-Mail Address:</strong> ${data.emailAddress}<br>
                                    <strong>URL:</strong> <a href="${data.url}" target="_blank">${data.url}</a><br><br>
                                    <strong>Category:</strong> ${data.category}<br>
                                    <strong>family friendly:</strong> ${data.familyFriendly ? '<img src="/images/okgreenPNG.png" alt="okgreen" style="width: 20px; height: 20px;">' : '<img src="/images/noredPNG.png" alt="nored" style="width: 20px; height: 20px;">'}<br>
                                    <strong>dog friendly:</strong> ${data.dogFriendly ? '<img src="/images/okgreenPNG.png" alt="okgreen" style="width: 20px; height: 20px;">' : '<img src="/images/noredPNG.png" alt="nored" style="width: 20px; height: 20px;">'}<br>
                                    <strong>spa:</strong> ${data.spa ? '<img src="/images/okgreenPNG.png" alt="okgreen" style="width: 20px; height: 20px;">' : '<img src="/images/noredPNG.png" alt="nored" style="width: 20px; height: 20px;">'}<br>
                                    <strong>fitness:</strong> ${data.fitness ? '<img src="/images/okgreenPNG.png" alt="okgreen" style="width: 20px; height: 20px;">' : '<img src="/images/noredPNG.png" alt="nored" style="width: 20px; height: 20px;">'}<br>
                                    <strong>subscribed:</strong> ${data.subscribed ? '<img src="/images/okgreenPNG.png" alt="okgreen" style="width: 20px; height: 20px;">' : '<img src="/images/noredPNG.png" alt="nored" style="width: 20px; height: 20px;">'}<br>
                                `);
                                $('#hotelInfoModal').show();
                            })
                            .catch(error => {
                                console.error('Error fetching hotel info:', error);
                                alert('Error fetching hotel info.');
                            });
                    }

                    function resetValidation() {
                        $('.is-invalid').removeClass('is-invalid');
                        $('[title]').removeAttr('title');
                    }
                });

                //Codeend_Lang_04.05.2024_19.05.2024_AddHotel Button Pop Up Window

                //Codebegin_Lang_27.04.2024/29.04.2024_Histogramm

                //Histogram Code teilweise von https://www.chartjs.org/

                let myChart = null;  // To keep track of the existing chart instance

                function drawHistogram() {
                    if (myChart) {
                        myChart.destroy();  // Destroy the existing chart instance if it exists
                    }
                    const ctx = document.getElementById('myChart').getContext('2d');

                    fetch('/occupancy/histogram-data')
                        .then(response => response.json())
                        .then(data => {
                            console.log('Received data from server:', data);
                            let labels, roomData, bedData;
                            if (Array.isArray(data)) {
                                labels = data.map(item => item.period);
                                roomData = data.map(item => item.totalUsedRooms);
                                bedData = data.map(item => item.totalUsedBeds);

                                myChart = new Chart(ctx, {
                                    type: 'bar',
                                    data: {
                                        labels: labels,
                                        datasets: [
                                            {
                                                label: 'sum of all hotel room occupancies',
                                                data: roomData,
                                                backgroundColor: 'rgb(255,189,89)',
                                                borderColor: 'rgb(255,189,89)',
                                                borderWidth: 1
                                            },
                                            {
                                                label: 'sum of all hotel bed occupancies',
                                                data: bedData,
                                                backgroundColor: 'rgb(74,141,208)',
                                                borderColor: 'rgb(74,141,208)',
                                                borderWidth: 1
                                            }
                                        ]
                                    },
                                    options: {
                                        scales: {
                                            y: {
                                                beginAtZero: true
                                            },
                                            x: {
                                                barPercentage: 0.4, // Adjusts the bar thickness
                                            }
                                        },
                                        plugins: {
                                            tooltip: {
                                                enabled: true
                                            },
                                            legend: {
                                                display: true,
                                                position: 'bottom',
                                                align: 'start'
                                            }
                                        }
                                    }
                                });
                                console.log('Created chart:', myChart);
                            } else {
                                console.error('Expected an array, received:', data);
                            }
                            console.log('data in histogram-index:', data);
                        })
                        .catch(error => console.error('Error loading the occupancy data:', error));
                }

            });

            //Codeend_Lang_27.04.2024/29.04.2024_Histogramm

            //Codeend_Lang_27.04.2024_Histogramm_Popup Window


            //Codebegin_Lang_14.04.2024_Sub_button_Script-----------------------------------------------------------------

            $('#hotelData').on('click', '.subscription-button', function() {
                console.log('DL TEST Sub-Button clicked!');

                var $button = $(this);
                var hotelId = $button.data('hotel-id');
                var $icon = $button.closest('tr').find('.subscription-icon'); // Das 'subscription-icon' in der gleichen Zeile

                // Loggen der Hotel-ID in der Konsole
                console.log('DL TEST Sub-Button Hotel ID: ' + hotelId);

                $.ajax({
                    url: '/' + hotelId + '/updateSubscription',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({}),
                    success: function(response) {

                        console.log('Response:' + response);

                        if (response) {
                            // Ermitteln des aktuellen Icons und Tauschen
                            var currentIcon = $button.find('img').attr('src');
                            var newIcon;
                            if (currentIcon.includes('subminusPNG.png')) {
                                newIcon = '/images/subplusPNG.png';
                            } else {
                                newIcon = '/images/subminusPNG.png';
                            }
                            newIcon += '?t=' + new Date().getTime(); // Hinzufügen eines Cache-Busters
                            $button.find('img').attr('src', newIcon);

                            var currentIcon = $icon.attr('src');
                            var newIcon;
                            if (currentIcon.includes('okgreenPNG.png')) {
                                newIcon = '/images/noredPNG.png';
                            } else {
                                newIcon = '/images/okgreenPNG.png';
                            }
                            // Hinzufügen eines Cache-Busters
                            newIcon += '?t=' + new Date().getTime();
                            // Aktualisier das Icon
                            $icon.attr('src', newIcon);

                        } else {
                            console.log('Operation failed or hotel not found');
                        }

                    },
                    error: function(xhr, status, error) {
                        // Fehlerbehandlung
                        console.error(xhr.responseText);

                    }
                });
            });

            //Codeend_Lang_14.04.2024_Sub_button_Script--------------------------------------------------------------------
        });

        document.addEventListener('DOMContentLoaded', function() {
            var myBtn = document.getElementById("myBtn");
            if (myBtn) {
                myBtn.addEventListener("click", function(event) {
                    event.preventDefault();
                    fetch('/occupancy/histogram-report', {
                        headers: {
                            'Accept': 'application/pdf'
                        }
                    })
                        .then(response => {
                            if (response.ok) {
                                return response.blob();  // Liest die Antwort als Blob, wenn die Antwort erfolgreich war
                            } else {
                                throw new Error('Failed to generate report');
                            }
                        })
                        .then(blob => {
                            const url = window.URL.createObjectURL(blob);
                            const a = document.createElement('a');
                            a.style.display = 'none';
                            a.href = url;
                            a.download = 'occupancy_histogram.pdf';
                            document.body.appendChild(a);
                            a.click();
                            window.URL.revokeObjectURL(url);
                            document.body.removeChild(a);
                        })
                        .catch(error => {
                            alert("An error occurred: " + error.message);
                        });
                });
            } else {
                console.log("Button not found");
            }
        });

        // backup code button

        function backupDatabase() {
            fetch('/backup')
                .then(response => response.text())
                .then(data => {
                    alert(data);
                    <!-- Codeanfang Nikola_13.06.2024_SendHotelBackupFile -->
                    fetch('/sendHotelBackupFilePerEmail')
                        .then(response => response.text())
                        .then(data => alert(data))
                        .catch(error => console.error('Fehler: ', error));
                    <!-- Codeende Nikola_13.06.2024_SendHotelBackupFile -->
                })
                .catch(error => console.error('Fehler:', error));
        }

        <!-- Codeanfang Nikola_13.06.2024_PopupForEmailNotification -->

        function sendEmailReport() {
            fetch('/sendSubscriptionMail')
                .then(response => response.text())
                .then(data => alert(data))
                .catch(error => console.error('Fehler: ', error));
        }

        <!-- Codeende Nikola_13.06.2024_PopupForEmailNotification -->

        <!-- Codeende_Achill_24.03.2024/27.08.2024/28.08.2024/01.04.2024/03.04.2024/19.04.2024/20.04.2024_Page-Navigation,SwitchZIPAscDesc,HotelDataInfo, ImportCsvData -->

    </script>
    <style>
        body {
            background-color: #66ccff;
        }
        .hiddenRow {
            height: 0;
            padding: 0;
            overflow: hidden;
        }

        #hotelData tbody tr:nth-child(even) {
            background-color: #ccffff !important;
        }

        .btn-pagination {
            background-color: white;
            color:black;
            min-width: 50px;
            padding: 0.5rem 0.75rem;
            text-align: center;
            margin: 0 5px;
            border: 1px solid #dee2e6;
            display: inline-block;
            margin-right: 10px;
            margin-left: 10px;
        }

        /* Style für den aktiven Button */
        .btn-pagination.active {
            background-color: #666666;
            color: white;
            border-color: #666666;
        }

        .btn-pagination:not(.active):hover {
            background-color: #5bc0de;
            color: white;
            border-color: #46b8da;
        }

        tr
        {
            background-color: white;
        }
        .topnav-upper {
            background-color: #66ccff;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 1rem;
        }
        .topnav-lower
        {
            background-color: #66ccff;
        }
        .logo {
            flex: 0 1 auto;
        }

        .user-controls {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }
        .flags-help-logout {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .menu-under-flags {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            margin-top: 10px;
        }
        .hotels-per-page-container {
            display: flex;
            gap: 10px;
        }
        .pagination-and-size-selector {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
        }
        .btn-pagination-arrow {
            background-color: #666666;
            border-color: black;
            color:white;
        }

        .btn-pagination-arrow:hover {
            background-color: #bbbbbb;
        }
    </style>
</head>
<body>
<!-- Codeanfang_#12_Veton_28.03.2024/inserted logo -->
<div class="topnav topnav-upper">
    <div class="logo">
        <img src="/images/Logo.jpg" alt="Logo">
    </div>
    <!-- Codeende#12_Veton_28.03.2024/inserted logo -->
    <div class="user-controls">
        <div class="flags-help-logout">
            <!-- Codebegin_Req#8_Lang_04.05.2024 -->

            <!-- Button -->
            <a id="btnHelp" class="btn btn-secondary" style="width: 80px; height: 42px;color:black; background-color: #dee2e6; font-weight: bold; border: 2px solid #004d40;">Help</a>

            <!-- Modal -->
            <div th:if="${isAdmin}" id="helpModal" class="modal">
                <div class="modal-content help-modal-content">
                    <h2 id="helpTitle">Help Information</h2>
                    <p id="helpText">Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat. Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper suscipit lobortis nisl ut aliquip ex ea commodo consequat. Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse molestie consequat, vel illum dolore eu feugiat nulla facilisis at vero et accumsan et iusto odio dignissim qui blandit praesent luptatum zzril delenit augue duis dolore te feugait nulla facilisi. Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat. Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper suscipit lobortis nisl ut aliquip ex ea commodo consequat. Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse molestie consequat, vel illum dolore eu feugiat nulla facilisis at vero et accumsan et iusto odio dignissim qui blandit praesent luptatum zzril delenit augue duis dolore te feugait nulla facilisi. Nam liber tempor cum soluta nobis eleifend option congue nihil imperdiet doming id quod mazim placerat facer possim assum.</p>
                    <button id="helpCloseBtn" class="close-btn">Close</button>
                </div>
            </div>

            <!-- Codeend_Req#8_Lang_04.05.2024 -->

            <a class="btn btn-secondary" href="/logout" style="width: 80px; height: 42px;color:black; background-color: #dee2e6; font-weight: bold; border: 2px solid #004d40;">Logout</a>
        </div>
        <div class="menu-under-flags">
            <!-- Zweite Navigationsleiste für Menülinks -->
            <div class="topnav topnav-lower">
                <div class="navigation-links">

                    <!--Codebegin_Lang_29.04.2024_04.05.2024_added_addHotel_Button-->

                    <!-- Button für Add Hotel -->
                    <a id="btnAddHotel" class="btn btn-secondary btn-AddHotel" style="color: white; background-color: teal; font-weight: bold; border: 2px solid black">Add Hotel</a>

                    <!-- Add Hotel Modal -->
                    <div id="addHotelModal" class="modal" style="display: none;">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h2 class="modal-title">Add Hotel:</h2>
                                </div>
                                <div class="modal-body">
                                    <form id="addHotelForm">
                                        <div class="form-group">
                                            <label for="addHotelName">Hotel Name:</label>
                                            <input type="text" id="addHotelName" name="name" class="form-control" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="addHotelAddress">Address:</label>
                                            <input type="text" id="addHotelAddress" name="address" class="form-control" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="addHotelZip">ZIP:</label>
                                            <input type="text" id="addHotelZip" name="cityCode" class="form-control" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="addHotelCity">City:</label>
                                            <input type="text" id="addHotelCity" name="city" class="form-control" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="addHotelOwner">Owner:</label>
                                            <input type="text" id="addHotelOwner" name="owner" class="form-control" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="addHotelContact">Contact:</label>
                                            <input type="text" id="addHotelContact" name="contact" class="form-control" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="addHotelPhone">Phone:</label>
                                            <input type="text" id="addHotelPhone" name="phone" class="form-control" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="addHotelEmail">E-mail address:</label>
                                            <input type="email" id="addHotelEmail" name="email" class="form-control" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="addHotelUrl">URL:</label>
                                            <input type="text" id="addHotelUrl" name="url" class="form-control">
                                        </div>
                                        <div class="form-group">
                                            <label for="addHotelRooms">Max Rooms:</label>
                                            <input type="text" id="addHotelRooms" name="email" class="form-control" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="addHotelBeds">Max Beds:</label>
                                            <input type="text" id="addHotelBeds" name="email" class="form-control" required>
                                        </div>
                                        <div class="form-group category">
                                            <label for="addHotelCategory">Category:</label>
                                            <select id="addHotelCategory" name="category" class="form-control select" required>
                                                <option value="" selected disabled>Select a category</option>
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                                <option value="5">5</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="addHotelFamilyFriendly">Family friendly:</label>
                                            <input type="checkbox" id="addHotelFamilyFriendly" name="familyFriendly">
                                        </div>
                                        <div class="form-group">
                                            <label for="addHotelDogFriendly">Dog friendly:</label>
                                            <input type="checkbox" id="addHotelDogFriendly" name="dogFriendly">
                                        </div>
                                        <div class="form-group">
                                            <label for="addHotelSpa">Spa:</label>
                                            <input type="checkbox" id="addHotelSpa" name="spa">
                                        </div>
                                        <div class="form-group">
                                            <label for="addHotelFitness">Fitness:</label>
                                            <input type="checkbox" id="addHotelFitness" name="fitness">
                                        </div>
                                        <div class="form-group">
                                            <label for="addHotelSubscribed">Subscribed:</label>
                                            <input type="checkbox" id="addHotelSubscribed" name="subscribed">
                                        </div>
                                        <div class="modal-footer">
                                            <button type="submit" class="btn btn-primary">Add Hotel</button>
                                            <button type="button" class="btn btn-secondary" id="addHotelCloseBtn">Cancel</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--Codeend_Lang_29.04.2024_04.05.2024_added_addHotel_Button-->

                    <!-- Codeanfang_Achill_ImportCsv_DataService/18.04.2024/19.04.2024/20.04.2024/23.04.2024/25.04.2024/26.04.2024 -->
                    <a class="btn btn-secondary" id="triggerCsvImport" href="javascript:void(0);" style="color: white; background-color: teal; font-weight: bold; border: 2px solid black">Import CSV Data</a>
                    <!-- Codeende_Achill_ImportCsv_DataService/18.04.2024/19.04.2024/20.04.2024/23.04.2024/25.04.2024/26.04.2024 -->
                    <a id="myBtn" class="btn btn-secondary" style="color:black; background-color: orange; font-weight: bold; border: 2px solid black">Statistics as PDF</a>
                    <!-- The Modal NOT USED AFTERWARDS BECAUSE FILE IS BEEN SAVED IN DIRECTORY BUT IT WORKS-->
                    <div id="myModal" class="modal">

                        <!-- Modal content -->
                        <div class="modal-content">
                            <span class="close">&times;</span>
                            <h2 style="font-weight: bold">Statistics as PDF</h2>
                            <br>
                            <p style="font-weight: bold">PDF has been saved.</p>
                            <br>
                            <button id="closeBtn">CLOSE</button>
                        </div>
                    </div>
                    <!--Codeanfang_Lang_27.04.2024_Histogram_Button-->

                    <!-- Button für das Histogramm -->
                    <a id="btnHistogram" class="btn btn-secondary btn-histogram" style="color:black; background-color: orange; font-weight: bold; border: 2px solid black">Statistics as Histogram</a>

                    <!-- The Modal -->
                    <div id="histogramModal" class="modal">
                        <!-- Modal content -->
                        <div class="modal-content histogram-modal-content">
                            <h2 id="histogramTitle">Statistics of all Hotels as Histogram</h2>
                            <!-- Histogram Container -->
                            <div class="histogram-container">
                                <canvas id="myChart"></canvas>
                            </div>

                            <button id="histogramCloseBtn" class="close">CLOSE</button>
                        </div>
                    </div>

                    <!--Codeende_Lang_27.04.2024_Histogram_Button-->

                    <!-- Codeanfang Nikola_13.06.2024_PopupForEmailNotification -->

                    <a class="btn btn-secondary" onclick="sendEmailReport()" style="color:black; background-color: yellow; font-weight: bold; border: 2px solid black">Send Subscription Mail</a>

                    <!-- Codeende Nikola_13.06.2024_PopupForEmailNotification -->

                    <a class="btn btn-secondary" href="#" onclick="backupDatabase()" style="color:black; background-color: yellow; font-weight: bold; border: 2px solid black">Create and Send Backup</a>
                </div>
            </div>
        </div>
    </div>
</div>

<hr>
<!-- Codeende_#1_Achill_22.03.2024/27.03.2024/28.03.2024_Menue-Top -->

<!-- Codeanfang_#1_Achill_10.03.2024/27.03.2024/28.03.2024/03.04.2024_Overview Of Hotels -->
<!-- Paginierungscontainer -->
<div class="pagination-and-size-selector">
    <div class="pagination-container" >
        <!-- Zur ersten Seite -->
        <a th:if="${hotelPage.number > 1}" th:href="@{/index(size=${hotelPage.size}, page=1)}" class="btn btn-pagination btn-pagination-arrow">&lt;&lt;</a>
        <!-- Zur vorherigen Seite -->
        <a th:if="${hotelPage.hasPrevious()}" th:href="@{/index(size=${hotelPage.size}, page=${hotelPage.number})}" class="btn btn-pagination btn-pagination-arrow">&lt;</a>

        <!-- Seitennummern -->
        <a th:each="pageNum : ${pageNumbers}"
           th:href="@{/index(size=${hotelPage.size}, page=${pageNum})}"
           th:text="${pageNum}"
           th:class="${pageNum == hotelPage.number + 1 ? 'btn btn-pagination active' : 'btn btn-pagination'}">
        </a>

        <!-- Zur nächsten Seite -->
        <a th:if="${hotelPage.hasNext()}" th:href="@{/index(size=${hotelPage.size}, page=${hotelPage.number + 2})}" class="btn btn-pagination btn-pagination-arrow">&gt;</a>
        <!-- Zur letzten Seite -->
        <a th:if="${hotelPage.number + 1 < totalPages}" th:href="@{/index(size=${hotelPage.size}, page=${totalPages})}" class="btn btn-pagination btn-pagination-arrow">&gt;&gt;</a>
    </div>
    <div class="hotels-per-page-container" >
        <!-- Das Formular zur Auswahl der Seitengröße -->
        <form action="/index" method="get" class="form-inline my-2 my-lg-0">
            <label for="pageSizeTop">Hotels per Page:</label>
            <select name="size" id="pageSizeTop" class="form-control form-control-sm" onchange="this.form.submit()">
                <option value="10">10</option>
                <option value="20">20</option>
                <option value="50">50</option>
                <option value="100">100</option>
                <option value="200">200</option>
                <option value="500">500</option>
                <option value="1000">1000</option>
            </select>
        </form>
    </div>
</div>
<br>
<div style="display: flex; justify-content: center;">
    <!-- Codebegin_Dominik_Lang_07.04.2024_added background color (mockup)-->
    <table id="hotelData" border="1">
        <!-- Codeend_Dominik_Lang_07.04.2024_added background color (mockup)-->
        <thead>
        <tr style="color: white; background-color: #6699cc" data-hotel-id="1" class="hotel-row">
            <!-- Codebegin_Dominik_Lang_07.04.2024_added style="width and text-align: center to Achills and Nikolas Code-->
            <th onclick="sortTable(0)" style="width: 80px; text-align: center">hotel ID</th>
            <th onclick="sortTable(1)">hotel name</th>
            <th style="width: 80px; text-align: center">ZIP <!--<i class="fa fa-sort-asc" onclick="sortTable(2)" style="cursor:pointer;"></i>--></th>
            <th style="width: 80px; text-align: center" onclick="sortTable(3)">category</th>
            <th style="width: 80px; text-align: center">family friendly</th>
            <th style="width: 80px; text-align: center">dog friendly</th>
            <th style="width: 80px; text-align: center">spa</th>
            <th style="width: 80px; text-align: center">fitness</th>
            <th style="width: 80px; text-align: center">subscribed</th>
            <th style="width: 100px; text-align: center">change subscription</th>
            <th style="width: 100px; text-align: center" >info</th>
            <!-- Codebegin_Dominik_Lang_04.05.2024_added_"updateHotel-->
            <th style="width: 100px; text-align: center" >update hotel</th>
            <!-- Codeend_Dominik_Lang_04.05.2024_added_"updateHotel-->
            <!-- Code Anfang #3_Nikola_06.04_Add Occupancy Form - Link "Add Occupancy" einfügen -->
            <th style="width: 100px; text-align: center">
                add occp. data
            </th>

            <!-- Code Ende #3_Nikola_06.04_Add Occupancy Form - Link "Add Occupancy" einfügen-->

            <th style="width: 100px; text-align: center">delete hotel</th>
            <!-- Codeende_Dominik_Lang_07.04.2024_added style="width and text-align: center to Achills and Nikolas Code-->
        </tr>
        </thead>
        <tbody>
        <th:block th:each="hotelEntry, hotelIterStat : ${hotelOccupancyMap}">
            <tr>
                <td data-toggle="collapse" th:attr="data-target='#hotelDetails' + ${hotelIterStat.index}" style="cursor: pointer;">
                    <span th:text="${hotelEntry.key.id}">Hotel ID</span>
                </td>
                <td data-toggle="collapse" th:attr="data-target='#hotelDetails' + ${hotelIterStat.index}"style="cursor: pointer;">
                    <span th:text="${hotelEntry.key.name}">Hotel Name</span>
                </td>
                <td data-toggle="collapse" th:attr="data-target='#hotelDetails' + ${hotelIterStat.index}"style="cursor: pointer;">
                    <span th:text="${hotelEntry.key.cityCode}">ZIP Code</span>
                </td>
                <td data-toggle ="collapse" th:attr="data-target='#hotelDetails' + ${hotelIterStat.index}"style="cursor: pointer;">
                    <span th:text="${hotelEntry.key.category}">Category</span>
                </td>

                <!-- Codebegin_Dominik_Lang_06.04.2024_added attributes and icons-->
                <td style="text-align: center;">
                    <img th:if="${hotelEntry.key.familyFriendly}" src="/images/okgreenPNG.png" alt="okgreen" style="width: 20px; height: 20px;">
                    <img th:unless="${hotelEntry.key.familyFriendly}" src="/images/noredPNG.png" alt="nored" style="width: 20px; height: 20px;">
                </td>
                <td style="text-align: center;">
                    <img th:if="${hotelEntry.key.dogFriendly}" src="/images/okgreenPNG.png" alt="okgreen" style="width: 20px; height: 20px;">
                    <img th:unless="${hotelEntry.key.dogFriendly}" src="/images/noredPNG.png" alt="nored" style="width: 20px; height: 20px;">
                </td>
                <td style="text-align: center;">
                    <img th:if="${hotelEntry.key.spa}" src="/images/okgreenPNG.png" alt="okgreen" style="width: 20px; height: 20px;">
                    <img th:unless="${hotelEntry.key.spa}" src="/images/noredPNG.png" alt="nored" style="width: 20px; height: 20px;">
                </td>
                <td style="text-align: center;">
                    <img th:if="${hotelEntry.key.fitness}" src="/images/okgreenPNG.png" alt="okgreen" style="width: 20px; height: 20px;">
                    <img th:unless="${hotelEntry.key.fitness}" src="/images/noredPNG.png" alt="nored" style="width: 20px; height: 20px;">
                </td>
                <td style="text-align: center;">
                    <img class="subscription-icon" data-hotel-id="${hotel.id}" th:if="${hotelEntry.key.subscribed}" src="/images/okgreenPNG.png" alt="okgreen" style="width: 20px; height: 20px;">
                    <img class="subscription-icon" data-hotel-id="${hotel.id}" th:unless="${hotelEntry.key.subscribed}" src="/images/noredPNG.png" alt="nored" style="width: 20px; height: 20px;">
                </td>
                <!-- Codeend_Dominik_Lang_06.04.2024_added attributes and icons-->

                <!-- Codebegin_Dominik_Lang_07.04.2024_added buttons and icons to html table-->
                <td style="text-align: center; padding: 0;" >
                    <button class="subscription-button"
                            style="width: 100%; height: 100%; padding: 0; border: 2px solid black; background: #cccccc; display: flex; justify-content: center; align-items: center;"
                            th:data-hotel-id="${hotelEntry.key.id}"
                            th:if="${isAdminOrEditor}">
                        <img th:if="${hotelEntry.key.subscribed}" src="/images/subminusPNG.png" alt="subminus" style="width: 20px; height: 20px;">
                        <img th:unless="${hotelEntry.key.subscribed}" src="/images/subplusPNG.png" alt="subplus" style="width: 20px; height: 20px;">
                    </button>
                </td>
                <!-- Codeend_Dominik_Lang_07.04.2024_added buttons and icons to html table-->

                <td style="text-align: center;">
                    <!-- CodeAnfang_Achill_Hotel Info-->
                    <button class="btn infoBtn"
                            style="width: 100%; height: 100%; padding: 0; border: 2px solid black; background: #cccccc; display: flex; justify-content: center; align-items: center;"
                            th:data-id="${hotelEntry.key.id}" th:data-name="${hotelEntry.key.name}"
                            th:data-address="${hotelEntry.key.address}" th:data-zip="${hotelEntry.key.cityCode}"
                            th:data-city="${hotelEntry.key.city}" th:data-owner="${hotelEntry.key.owner}"
                            th:data-contact="${hotelEntry.key.contact}" th:data-phone="${hotelEntry.key.phone}"
                            th:data-email-address="${hotelEntry.key.emailAddress}" th:data-url="${hotelEntry.key.url}"
                            th:data-category="${hotelEntry.key.category}" th:data-family-friendly="${hotelEntry.key.familyFriendly}"
                            th:data-dog-friendly="${hotelEntry.key.dogFriendly}"
                            th:data-spa="${hotelEntry.key.spa}" th:data-fitness="${hotelEntry.key.fitness}"
                            th:data-subscribed="${hotelEntry.key.subscribed}"
                            onclick="showHotelInfo(this)">
                        <!-- Codebegin_Dominik_Lang_07.04.2024_added icon-->
                        <img src="/images/detailsPNG.png" alt="details" style="width: 20px; height: 20px;">
                        <!-- Codeend_Dominik_Lang_07.04.2024_added icon-->
                    </button>
                    <!-- Codeende_Achill_Hotel Info-->

                    <!-- Codebegin_Dominik_Lang_04.05.2024_added updateHotel-button and icons to html table-->
                <td style="text-align: center; padding: 0;">
                    <a th:href="@{/updatehotel/{id}(id=${hotelEntry.key.id})}" style="display: block; width: 100%; height: 100%; padding: 0;">
                        <button class="update-button" style="width: 100%; height: 100%; padding: 0; border: 2px solid black; background: #cccccc; display: flex; justify-content: center; align-items: center;">
                            <img src="/images/update_PNG.png" alt="update" style="width: 20px; height: 20px;">
                        </button>
                    </a>
                </td>
                <!-- Codeend_Dominik_Lang_04.05.2024_added updateHotel-button and icons to html table-->

                <!-- Codebegin_Dominik_Lang_07.04.2024_added buttons and icons to html table-->
                <td style="text-align: center; padding: 0;">
                    <!--Code Anfang #3_Nikola_02.05 Occupancy Form -->
                    <button class="btn" style="width: 100%; height: 100%; padding: 0; border: 2px solid black; background: #cccccc; display: flex; justify-content: center; align-items: center;"
                            th:data-id="${hotelEntry.key.id}" th:data-name="${hotelEntry.key.name}"
                            th:data-zip="${hotelEntry.key.cityCode}" th:data-maxRooms="${hotelEntry.key.noRooms}"
                            th:data-maxBeds="${hotelEntry.key.noBeds}" th:if="${isAdminOrEditor}"
                            onclick="addOccupancy(this)">
                        <img src="/images/addOccpPNG.png" alt="addOccp" style="width: 20px; height: 20px;">
                    </button>
                    <!--Code Ende #3_Nikola_02.05 Occupancy Form -->
                </td>

                <td style="text-align: center; padding: 0;">
                    <button class="btn" style="width: 100%; height: 100%; padding: 0; border: 2px solid black; background: #cccccc; display: flex; justify-content: center; align-items: center;" th:if="${isAdminOrEditor}" th:data-id="${hotelEntry.key.id}" th:data-name="${hotelEntry.key.name}" th:data-zip="${hotelEntry.key.cityCode}" onclick="deleteHotel(this)">
                        <img src="/images/deletePNG.png" alt="delete" style="width: 20px; height: 20px;">
                    </button>
                </td>
                <!-- Codeend_Dominik_Lang_07.04.2024_added buttons and icons to html table-->

                <!-- <td>
                     <button onclick="toggleOccupancy('${hotel.id}')" class="btn btn-info">Show Occupancy</button>
                 </td>
                 -->
            </tr>
            <tr>
                <td colspan="14" class="hiddenRow">
                    <div th:id="'hotelDetails' + ${hotelIterStat.index}" class="collapse">
                        <table class="table" style="background-color: #000000;width: 100%;">
                            <tbody style="background-color: #9f9f9f;">
                            <!-- Hier die Tabelle "last 12 Entries" hinzufügen -->
                            <tr data-toggle="collapse" th:attr="data-target='#last12Months' + ${hotelIterStat.index}" class="accordion-toggle" style="cursor: pointer;">
                                <td colspan="14" style="text-align: left; background-color: white;">
                                    <h3 style="font-size: 1.0em; margin: 0; color: black;">Last 12 Entries</h3> <!-- Verkleinertes h3 und weißer Text -->
                                </td>
                            </tr>
                            <tr>
                                <td colspan="14" class="hiddenRow" style="height: 0; padding: 0; overflow: hidden">
                                    <div th:id="'last12Months' + ${hotelIterStat.index}" class="collapse">
                                        <table class="table" style="width: 100%; background-color: #333;">
                                            <thead>
                                            <tr>
                                                <th style="width: 80px; text-align: center">month</th>
                                                <th style="width: 80px; text-align: center">total rooms</th>
                                                <th style="width: 80px; text-align: center">booked rooms</th>
                                                <th style="width: 80px; text-align: center">room occp. in %</th>
                                                <th style="width: 80px; text-align: center">total beds</th>
                                                <th style="width: 80px; text-align: center">booked beds</th>
                                                <th style="width: 80px; text-align: center">bed occp. in %</th>
                                                <th style="width: 80px; text-align: center">#1 of national guest</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <tr th:each="occupancy : ${last12MonthsMap[hotelEntry.key]}">
                                                <td th:text="${occupancy.month}" style="text-align: center;"></td>
                                                <td th:text="${occupancy.rooms}" style="text-align: center;"></td>
                                                <td th:text="${occupancy.usedrooms}" style="text-align: center;"></td>
                                                <td th:text="${occupancy.rooms > 0 ? (occupancy.usedrooms * 100 / occupancy.rooms) + '%' : '0%'}" style="text-align: center;"></td>
                                                <td th:text="${occupancy.beds}" style="text-align: center;"></td>
                                                <td th:text="${occupancy.usedbeds}" style="text-align: center;"></td>
                                                <td th:text="${occupancy.beds > 0 ? (occupancy.usedbeds * 100 / occupancy.beds) + '%' : '0%'}" style="text-align: center;"></td>
                                                <td th:text="${occupancy.nationality}" style="text-align: center;"></td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </td>
                            </tr>
                            <!-- Ende der Tabelle "last 12 Entries" -->
                            <th:block th:each="yearEntry, yearIterStat : ${hotelEntry.value.entrySet()}">
                                <tr data-toggle="collapse" th:attr="data-target='#yearDetails' + ${hotelIterStat.index} + '_' + ${yearIterStat.index}" class="accordion-toggle" style="cursor: pointer;">
                                    <td th:text="${yearEntry.key}" style="text-align: left;"></td>
                                </tr>
                                <tr>
                                    <td colspan="14" class="hiddenRow" style="height: 0; padding: 0; overflow: hidden;">
                                        <div th:id="'yearDetails' + ${hotelIterStat.index} + '_' + ${yearIterStat.index}" class="collapse">
                                            <table class="table" style="width: 100%">
                                                <thead>
                                                <tr>
                                                    <th style="width: 80px; text-align: center">month</th>
                                                    <th style="width: 80px; text-align: center">total rooms</th>
                                                    <th style="width: 80px; text-align: center">booked rooms</th>
                                                    <th style="width: 80px; text-align: center">room occp. in %</th>
                                                    <th style="width: 80px; text-align: center">total beds</th>
                                                    <th style="width: 80px; text-align: center">booked beds</th>
                                                    <th style="width: 80px; text-align: center">bed occp. in %</th>
                                                    <th style="width: 80px; text-align: center">#1 of national guest</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr th:each="occupancy : ${yearEntry.value}">
                                                    <td th:text="${occupancy.month}" style="text-align: center;"></td>
                                                    <td th:text="${occupancy.rooms}" style="text-align: center;"></td>
                                                    <td th:text="${occupancy.usedrooms}" style="text-align: center;"></td>
                                                    <td th:text="${occupancy.rooms > 0 ? (occupancy.usedrooms * 100 / occupancy.rooms) + '%' : '0%'}" style="text-align: center;"></td>
                                                    <td th:text="${occupancy.beds}" style="text-align: center;"></td>
                                                    <td th:text="${occupancy.usedbeds}" style="text-align: center;"></td>
                                                    <td th:text="${occupancy.beds > 0 ? (occupancy.usedbeds * 100 / occupancy.beds) + '%' : '0%'}" style="text-align: center;"></td>
                                                    <td th:text="${occupancy.nationality}" style="text-align: center;"></td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </td>
                                </tr>
                            </th:block>
                            </tbody>
                        </table>
                    </div>
                </td>
            </tr>
        </th:block>

        </tbody>
    </table>
</div>
<div id="hotelInfoModal" class="modal">
    <div class="modal-content" style="width: 30%">
        <h2>HOTEL INFO:</h2>
        <div id="hotelInfoContent">
            <!-- Hotelinfos -->
        </div>
        <br>
        <button id="closeInfo">CANCEL</button>
    </div>
</div>
<br>

<!-- Modal -->
<div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="errorModalLabel">Fehler</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p th:text="${errorMessage}"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Schließen</button>
            </div>
        </div>
    </div>
</div>

<!-- CodeAnfang_Achill_Paginierungscontainer -->
<div class="pagination-and-size-selector">
    <div class="pagination-container" >
        <!-- Zur ersten Seite -->
        <a th:if="${hotelPage.number > 1}" th:href="@{/index(size=${hotelPage.size}, page=1)}" class="btn btn-pagination btn-pagination-arrow">&lt;&lt;</a>
        <!-- Zur vorherigen Seite -->
        <a th:if="${hotelPage.hasPrevious()}" th:href="@{/index(size=${hotelPage.size}, page=${hotelPage.number})}" class="btn btn-pagination btn-pagination-arrow">&lt;</a>

        <!-- Seitennummern -->
        <a th:each="pageNum : ${pageNumbers}"
           th:href="@{/index(size=${hotelPage.size}, page=${pageNum})}"
           th:text="${pageNum}"
           th:class="${pageNum == hotelPage.number + 1 ? 'btn btn-pagination active' : 'btn btn-pagination'}">
        </a>

        <!-- Zur nächsten Seite -->
        <a th:if="${hotelPage.hasNext()}" th:href="@{/index(size=${hotelPage.size}, page=${hotelPage.number + 2})}" class="btn btn-pagination btn-pagination-arrow">&gt;</a>
        <!-- Zur letzten Seite -->
        <a th:if="${hotelPage.number + 1 < totalPages}" th:href="@{/index(size=${hotelPage.size}, page=${totalPages})}" class="btn btn-pagination btn-pagination-arrow">&gt;&gt;</a>
    </div>

    <div class="hotels-per-page-container">
        <!-- Das Formular zur Auswahl der Seitengröße -->
        <form action="/index" method="get" class="form-inline">
            <label for="pageSizeBottom">Hotels per Page:</label>
            <select name="size" id="pageSizeBottom" class="form-control form-control-sm" onchange="this.form.submit()">
                <option value="10">10</option>
                <option value="20">20</option>
                <option value="50">50</option>
                <option value="100">100</option>
                <option value="200">200</option>
                <option value="500">500</option>
                <option value="1000">1000</option>
            </select>
        </form>
    </div>
</div>
<!-- Codeende #1_Achill_10.03.2024/27.03.2024/28.03.2024/03.04.2024_Overview Of Hotels -->
</body>
</html>